(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5141:function(e,t,n){Promise.resolve().then(n.bind(n,6237))},6237:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return es}});var s=n(7437),a=n(2265),o=n(6507),i=n(1101),l=n(5133),r=n(8469),c=n(3226),h=n(327),x=n(6801),d=n(8819),p=n(231),u=function(e){(0,i.Z)();let[t,n]=(0,a.useState)("assistant"===e.role?"AI助手":"您"),[u,j]=(0,a.useState)(e.content),Z="assistant"===e.role?{justifyContent:"flex-start"}:{justifyContent:"flex-end"},f="assistant"===e.role?"#F5F5F5":"#4169E1",g="assistant"===e.role?"black":"white";return(0,a.useEffect)(()=>{j(e.content)},[e.content]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(o.Z,{sx:{display:"flex",height:"auto",marginTop:"10px"},style:Z,children:["assistant"===e.role?(0,s.jsx)(h.Z,{sx:{color:x.Z[500],fontSize:"30px"}}):(0,s.jsx)(p.Z,{sx:{color:d.Z[900],fontSize:"30px"}}),(0,s.jsx)(c.Z,{component:"div",variant:"h6",fontWeight:"bold",sx:{marginLeft:"1%"},children:t})]}),(0,s.jsx)(o.Z,{sx:{display:"flex"},style:Z,children:(0,s.jsx)(l.Z,{sx:{display:"inline-block",width:"auto",marginTop:"10px",bgcolor:"".concat(f),maxWidth:"100%"},style:Z,children:(0,s.jsx)(o.Z,{children:(0,s.jsx)(r.Z,{sx:{flex:"1"},children:(0,s.jsx)(c.Z,{component:"div",variant:"body1",style:{color:"".concat(g)},children:u})})})})})]})};class j{constructor(e,t,n){this.avatar=e,this.messages=t,this.role=n}}n(1596);var Z=n(6055),f=n(5544),g=n(4404),m=n(2653),y=n(4978),v=n(6398);let b={Message:""},w=(0,a.createContext)({chatInfo:b,setChatInfo:e=>{}}),C=e=>{let{children:t}=e,[n,o]=(0,a.useState)(b);return(0,s.jsx)(w.Provider,{value:{chatInfo:n,setChatInfo:o},children:t})};var S=n(209),k=n(2984),z=n(9168),E=n(682),T=n(7697),M=n(7292),O=n(9804);let P=["脚手架的操作规范","矿井内氧气含量过低怎么办","遭遇恶劣天气应该如何处理","申报中国电力优质工程的条件","安全质量部的工作是什么","施工组织设计的编制的要求","如何防止高处坠落事故","人工挖孔桩的设计要求","如何防止边坡坍塌","塔机的尾部与周围建筑物及其外围施工设施之间的安全距离是多少","如何防止缆索起重机起重伤害","如何防止高压触电事故","为了防止机械伤害事故，应采取哪些措施","什么情况下严禁对已充油的变压器、电抗器的微小渗漏进行补焊","如何防止燃油罐区火灾","如何防止场内车辆伤害事故","液氨储罐区的设置要求"];function A(e){let{chatInfo:t,setChatInfo:n}=(0,a.useContext)(w),[o,i]=(0,a.useState)(""),[l,r]=(0,a.useState)(!1),[c,h]=(0,a.useState)(!1),x=e.readytosend,d=()=>{x&&(console.log("send ",o),n({...t,Message:o}),i(""))},[p,u]=(0,a.useState)(!1),{transcript:j,listening:b,resetTranscript:C,browserSupportsSpeechRecognition:A}=(0,T.x6)(),[I,F]=(0,a.useState)("");A||console.log("not support"),(0,a.useEffect)(()=>{p&&i("".concat(I).concat(j))},[j]),(0,a.useEffect)(()=>{F(o)},[p]),(0,a.useEffect)(()=>{p||F(o)},[o]);let B=async()=>{C(),u(!0),await T.ZP.startListening({continuous:!0,language:"zh-CN"}),console.log("start")},D=async()=>{u(!1),await T.ZP.stopListening(),console.log("end")};return(0,s.jsxs)(Z.Z,{sx:{p:"2px 4px",display:"flex",alignItems:"center",maxWidth:620,margin:"auto",marginTop:"3vh",height:"7vh",border:"1px solid #ccc",borderRadius:"5px"},elevation:0,onKeyDown:e=>{"Enter"===e.key&&d()},children:[(0,s.jsx)(E.Z,{title:"提示词",placement:"top",arrow:!0,children:(0,s.jsx)(m.Z,{sx:{p:"10px"},"aria-label":"menu",onClick:()=>{i(P[Math.floor(17*Math.random())])},children:(0,s.jsx)(y.Z,{})})}),(0,s.jsx)(f.ZP,{sx:{ml:1,flex:1},placeholder:"请输入内容",inputProps:{"aria-label":"search google maps"},onChange:e=>{i(e.target.value)},value:o}),null!=o&&""!=o?(0,s.jsx)(E.Z,{title:"清除",placement:"top",arrow:!0,children:(0,s.jsx)(m.Z,{type:"button",sx:{p:"10px"},"aria-label":"search",onClick:()=>{i("")},children:(0,s.jsx)(S.Z,{})})}):null,p?(0,s.jsx)(E.Z,{title:"停止",placement:"top",arrow:!0,children:(0,s.jsx)(m.Z,{type:"button",sx:{p:"10px"},"aria-label":"search",onClick:D,children:(0,s.jsx)(z.Z,{})})}):(0,s.jsx)(E.Z,{title:"语音",placement:"top",arrow:!0,children:(0,s.jsx)(m.Z,{type:"button",sx:{p:"10px"},"aria-label":"search",onClick:B,children:(0,s.jsx)(k.Z,{})})}),(0,s.jsx)(E.Z,{title:"发送",placement:"top",arrow:!0,children:(0,s.jsx)(m.Z,{disabled:!x,type:"button",sx:{p:"10px"},"aria-label":"search",onClick:d,children:(0,s.jsx)(v.Z,{})})}),(0,s.jsx)(g.Z,{sx:{height:28,m:.5},orientation:"vertical"}),(0,s.jsx)(M.Z,{open:c,onClose:()=>h(!1),anchorOrigin:{vertical:"top",horizontal:"left"},children:(0,s.jsx)(O.Z,{severity:"warning",children:"只能上传pdf文件"})})]})}var I=n(2173);let F="http://8.130.122.17:5000";var B=n(2057),D=n(5873),L=n(8768),N=n(1344),_=()=>{let[e,t]=(0,a.useState)(""),n=new j("","你好！我是ai问答助手，很高兴为您提供帮助。请问您有什么问题需要我解答？","assistant"),[i,l]=(0,a.useState)([n]),{chatInfo:r,setChatInfo:h}=(0,a.useContext)(w),[x,d]=(0,a.useState)(!1),[p,Z]=(0,a.useState)([]),[f,g]=(0,a.useState)([]),[m,y]=(0,a.useState)(!0);(0,a.useEffect)(()=>{if(""!==r.Message){Z([]),g([]);let e=new j("",r.Message,"you");l(t=>[...t,e]);let t=new j("","","assistant");l(e=>[...e,t]),d(!0)}},[r.Message]),(0,a.useEffect)(()=>{let e=async()=>{try{let e=await fetch("".concat(F,"/api/data"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer test"},body:JSON.stringify({question:r.Message})}),t=e.body,n=t.getReader(),s="",a=async()=>{for(y(!1);;){let{done:e,value:t}=await n.read();if(e){""!=s&&I.Z.get("".concat(F,"/api/source"),{headers:{"Content-Type":"application/json",Authorization:"Bearer test"}}).then(e=>{Z(e.data.texts),g(e.data.sources),console.log(e.data)}).catch(e=>{console.error(e)}),y(!0);break}let a=new TextDecoder().decode(t);s+=a,l(e=>{let t=[...e],n=t[t.length-1];return n.messages=s,t})}};await a();return}catch(e){console.error(e)}};0!==i.length&&(e(),d(!1),h({...r,Message:""}))},[x]);let v=i.map((e,t)=>(0,s.jsx)(u,{role:e.role,content:e.messages},t)),b=(0,a.useRef)(null),C=()=>{b&&b.current&&(b.current.scrollTop=b.current.scrollHeight)},S=p.map((e,t)=>{let n="".concat(f[t]);return(0,s.jsxs)(B.Z,{children:[(0,s.jsx)(D.Z,{expandIcon:(0,s.jsx)(N.Z,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,s.jsx)(c.Z,{children:n})}),(0,s.jsx)(L.Z,{children:(0,s.jsx)(c.Z,{children:e})})]},t)});return(0,a.useEffect)(()=>{C()},[i]),(0,s.jsxs)("div",{style:{width:"100%",height:"100%",backgroundImage:"url()"},children:[(0,s.jsx)(c.Z,{variant:"h2",fontWeight:"bold",sx:{height:"10vh"},gutterBottom:!0,children:(0,s.jsx)("center",{children:"AI问答"})}),(0,s.jsxs)(o.Z,{sx:{height:"70vh",maxWidth:"600px",overflow:"auto",border:"1px solid #ccc",borderRadius:"5px",padding:"10px",display:"block",margin:"auto",bgcolor:"white"},ref:b,children:[v,0!=p.length&&(0,s.jsxs)(B.Z,{children:[(0,s.jsx)(D.Z,{expandIcon:(0,s.jsx)(N.Z,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:(0,s.jsx)(c.Z,{children:"参考文献"})}),(0,s.jsx)(L.Z,{children:S})]},"files")]}),(0,s.jsx)(A,{readytosend:m})]})},H=n(5667),W=n(8506),R=n(8743),q=n(9394),J=n(1797),K=n(6337),G=n(1679),Q=n(2834),U=n(9050),V=n(4957),X=n(2191),Y=n(1991),$=n(7198),ee=n(6446);function et(e){let t=async()=>{let t=await I.Z.post("".concat(F,"/file/delete"),{filename:e.filename},{headers:{"Content-Type":"application/json",Authorization:"Bearer test"}});console.log(t),e.refresh()};return(0,s.jsxs)(l.Z,{sx:{display:"flex"},children:[(0,s.jsx)(c.Z,{variant:"h6",sx:{ml:1,flex:1},children:e.filename}),(0,s.jsx)(m.Z,{sx:{p:"10px"},color:"error",onClick:t,children:(0,s.jsx)(ee.Z,{})})]})}function en(){let[e,t]=a.useState(null),[n,i]=(0,a.useState)(!1),[l,r]=(0,a.useState)(!1),[c,h]=(0,a.useState)(!1),[x,d]=(0,a.useState)(!1),[p,u]=(0,a.useState)(!1),j=[{icon:(0,s.jsx)(X.Z,{color:"primary"}),name:"上传文件",action:()=>{i(!0)}},{icon:(0,s.jsx)(k.Z,{color:"primary"}),name:"语音上传",action:()=>{r(!0)}},{icon:(0,s.jsx)($.Z,{color:"primary"}),name:"文件列表",action:()=>{h(!0)}}];async function Z(){try{if(null==e)b(!0);else{i(!1),console.log(e);let t=new FormData;t.append("file",e);let n=await I.Z.post("".concat(F,"/file/upload"),t,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer test"}});200==n.status?(d(!0),ex()):u(!0),console.log(n)}}catch(e){console.error(e)}}async function f(){try{if(null===D||""===D||void 0===D)C(!0);else{r(!1);let e=await I.Z.post("".concat(F,"/file/audio"),{text:D},{headers:{"Content-Type":"application/json",Authorization:"Bearer test"}});200==e.status?(P(!0),ex()):B(!0),console.log(e)}}catch(e){console.error(e)}}let[g,y]=(0,a.useState)(!1),[v,b]=(0,a.useState)(!1),[w,C]=(0,a.useState)(!1),[S,P]=(0,a.useState)(!1),[A,B]=(0,a.useState)(!1),[D,L]=(0,a.useState)(""),[N,_]=(0,a.useState)(!1),{transcript:ee,listening:en,resetTranscript:es,browserSupportsSpeechRecognition:ea}=(0,T.x6)(),[eo,ei]=(0,a.useState)("");ea||console.log("not support"),(0,a.useEffect)(()=>{N&&L("".concat(eo).concat(ee))},[ee]),(0,a.useEffect)(()=>{ei(D)},[N]),(0,a.useEffect)(()=>{N||ei(D)},[D]);let el=async()=>{es(),await T.ZP.startListening({continuous:!0,language:"zh-CN"}),_(!0),console.log("start")},er=async()=>{es(),_(!1),await T.ZP.stopListening(),console.log("end")},[ec,eh]=(0,a.useState)((0,s.jsx)(o.Z,{})),ex=async()=>{let e=await I.Z.get("".concat(F,"/file/getfiles"),{headers:{"Content-Type":"application/json",Authorization:"Bearer test"}});console.log(e.data);let t=e.data.filenames.map((e,t)=>(0,s.jsx)(et,{filename:e,refresh:ex},t));eh((0,s.jsx)(o.Z,{children:t}))};return(0,a.useEffect)(()=>{ex()},[]),(0,s.jsxs)(o.Z,{children:[(0,s.jsx)(W.Z,{ariaLabel:"SpeedDial basic example",sx:{position:"absolute",bottom:"15vh",right:"10%"},icon:(0,s.jsx)(Y.Z,{}),FabProps:{size:"large"},children:j.map(e=>(0,s.jsx)(R.Z,{icon:e.icon,tooltipTitle:e.name,onClick:e.action},e.name))}),n&&(0,s.jsxs)(q.Z,{sx:{"& .MuiDialog-paper":{width:"80%",maxHeight:435}},open:n,children:[(0,s.jsx)(J.Z,{children:"上传文件"}),(0,s.jsx)(K.Z,{children:(0,s.jsx)(o.Z,{sx:{display:"inline-block",margin:"auto",width:"100%"},children:(0,s.jsx)(H.z,{value:e,onChange:e=>{if(null!==e){"application/pdf"===e.type?t(e):(y(!0),t(null));return}t(e)},style:{width:"100%"},hideSizeText:!0,InputProps:{startAdornment:(0,s.jsx)(G.Z,{position:"start",children:(0,s.jsx)(X.Z,{})})}})})}),(0,s.jsxs)(Q.Z,{children:[(0,s.jsx)(U.Z,{autoFocus:!0,onClick:()=>i(!1),children:"取消"}),(0,s.jsx)(U.Z,{onClick:Z,children:"确定"})]})]}),l&&(0,s.jsxs)(q.Z,{sx:{"& .MuiDialog-paper":{width:"80%",maxHeight:435}},open:l,children:[(0,s.jsx)(J.Z,{children:"输入条目"}),(0,s.jsx)(K.Z,{children:(0,s.jsx)(V.Z,{multiline:!0,sx:{width:"100%",maxHeight:"200px",overflow:"auto"},value:D,onChange:e=>{L(e.target.value)}})}),(0,s.jsxs)(Q.Z,{children:[(0,s.jsx)(U.Z,{autoFocus:!0,onClick:()=>r(!1),children:"取消"}),(0,s.jsx)(U.Z,{onClick:f,children:"确定"})]}),(0,s.jsx)(o.Z,{sx:{display:"block",position:"absolute",bottom:"5%",left:"5%"},children:(0,s.jsx)(E.Z,{title:"语音输入",placement:"top",arrow:!0,children:(0,s.jsx)(m.Z,{type:"button","aria-label":"search",onClick:N?er:el,children:N?(0,s.jsx)(z.Z,{}):(0,s.jsx)(k.Z,{})})})})]}),c&&(0,s.jsxs)(q.Z,{sx:{"& .MuiDialog-paper":{width:"80%",maxHeight:435}},open:c,children:[(0,s.jsx)(J.Z,{children:"已上传文件"}),(0,s.jsx)(K.Z,{children:ec}),(0,s.jsx)(Q.Z,{children:(0,s.jsx)(U.Z,{onClick:()=>{h(!1)},children:"确定"})})]}),(0,s.jsx)(M.Z,{open:g,onClose:()=>y(!1),anchorOrigin:{vertical:"top",horizontal:"left"},children:(0,s.jsx)(O.Z,{severity:"warning",children:"只能上传pdf文件"})}),(0,s.jsx)(M.Z,{open:v,onClose:()=>b(!1),anchorOrigin:{vertical:"top",horizontal:"left"},children:(0,s.jsx)(O.Z,{severity:"warning",children:"请先选择文件"})}),(0,s.jsx)(M.Z,{open:x,onClose:()=>d(!1),anchorOrigin:{vertical:"top",horizontal:"left"},children:(0,s.jsx)(O.Z,{severity:"success",children:"文件上传完毕"})}),(0,s.jsx)(M.Z,{open:p,onClose:()=>u(!1),anchorOrigin:{vertical:"top",horizontal:"left"},children:(0,s.jsx)(O.Z,{severity:"error",children:"文件上传失败"})}),(0,s.jsx)(M.Z,{open:w,onClose:()=>C(!1),anchorOrigin:{vertical:"top",horizontal:"left"},children:(0,s.jsx)(O.Z,{severity:"warning",children:"请先输入内容"})}),(0,s.jsx)(M.Z,{open:S,onClose:()=>P(!1),anchorOrigin:{vertical:"top",horizontal:"left"},children:(0,s.jsx)(O.Z,{severity:"success",children:"条目上传完毕"})}),(0,s.jsx)(M.Z,{open:A,onClose:()=>B(!1),anchorOrigin:{vertical:"top",horizontal:"left"},children:(0,s.jsx)(O.Z,{severity:"error",children:"条目上传失败"})})]})}function es(){return(0,s.jsxs)("main",{children:[(0,s.jsx)(C,{children:(0,s.jsx)(_,{})}),(0,s.jsx)(en,{})]})}}},function(e){e.O(0,[394,451,971,472,744],function(){return e(e.s=5141)}),_N_E=e.O()}]);